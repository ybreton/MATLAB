function sd = DD_explore_titrate_exploit(sd,varargin)
%
%
%
%

window = 5;
plotResult = true;
firstLap = 2;
SSN = '';
process_varargin(varargin);

halfWidth = floor(window/2);

nLaps = length(sd.ZoneIn);

firstLap = max(firstLap,floor(window/2)+1);

% when window = 5, firstLap = floor(5/2)+1 = 3 (LESS 2, PLUS 2)
% when window = 7, firstLap = floor(7/2)+1 = 4 (LESS 3, PLUS 3)
% etc.

C = sd.ZoneIn;
one = C(firstLap:end-1);
two = C(firstLap+1:end);
lapsOne = firstLap:length(C)-1;
lapsTwo = firstLap+1:length(C);

sd.alternated = nan(length(C),1);
sd.alternated(firstLap+1:end) = abs(one-two);

sd.phase = nan(length(sd.alternated),1);
cp = 1;
[~,Dadj] = DD_getDelays(sd);
hold on
for iLap = firstLap : nLaps;
    id = lapsOne>=(iLap-halfWidth) & lapsTwo<=(iLap+halfWidth);
    
    sd.phase(iLap) = (nanmean(sd.alternated(id))>0.5);
end
hold off